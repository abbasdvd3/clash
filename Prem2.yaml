

proxy-groups:
  - name: Proxy
    type: url-test
    interval: 12
    tolerance: 15
    url: http://www.gstatic.com/generate_204
    use: 
    proxies:
      - Auto
      - Geo-HK
      - Geo-TW
      - Geo-SG
      - Geo-JP
      - Geo-US
      - Geo-UK
      - Geo-DE
      - Geo-CN
 #     - DIRECT
  #    - Block
  - name: Auto
    type: url-test
    interval: 12
    tolerance: 15
    url: http://www.gstatic.com/generate_204
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
     
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
#      - Subscription-16
      - Subscription-17
      - Subscription-18
  
      - Subscription-20
#      - Subscription-21
 
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-HK
    type: url-test
    interval: 300
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "HongKong|HK|香港"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
     
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
 #     - Subscription-16
      - Subscription-17
      - Subscription-18
  
      - Subscription-20
#      - Subscription-21
   
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-TW
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
    filter: "Taiwan|TW|台湾"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
  
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
  #    - Subscription-16
      - Subscription-17
      - Subscription-18
   
      - Subscription-20
  #    - Subscription-21
  
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-SG
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
    filter: "Singapore|SG|新加坡"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
  
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
 #     - Subscription-16
      - Subscription-17
      - Subscription-18
  
      - Subscription-20
 #     - Subscription-21
   
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-JP
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
    filter: "Japan|JP|日本"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10

      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
#      - Subscription-16
      - Subscription-17
      - Subscription-18
   
      - Subscription-20
#      - Subscription-21
     
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-US
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
    filter: "America|United States|US|美国"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10

      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
#      - Subscription-16
      - Subscription-17
      - Subscription-18
 
      - Subscription-20
#      - Subscription-21
      - Subscription-23
      - Subscription-24
      - Subscription-25
  - name: Geo-UK
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
    filter: "Britain|England|UK|英国|tr|s|ss"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
  
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
#      - Subscription-16
      - Subscription-17
      - Subscription-18
    
      - Subscription-20
#      - Subscription-21
 
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-DE
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
    filter: "Germany|Deutsch|DE|德国"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
 
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
#      - Subscription-16
      - Subscription-17
      - Subscription-18
 
      - Subscription-20
 #     - Subscription-21
 
      - Subscription-23
      - Subscription-24
      - Subscription-25

  - name: Geo-CN
    type: url-test
    interval: 30
    tolerance: 10
    url: http://www.gstatic.com/generate_204
#    disable-dns: false
    filter: "China|CN|中国"
    use: 
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7
      - Subscription-8
      - Subscription-9
      - Subscription-10
 
      - Subscription-12
      - Subscription-13
      - Subscription-14
      - Subscription-15
#      - Subscription-16
      - Subscription-17
      - Subscription-18
 
      - Subscription-20
 #     - Subscription-21
 
      - Subscription-23
      - Subscription-24
      - Subscription-25
    proxies:
 #     - DIRECT

  - name: Block
    type: select
    use: 
    proxies:
      - REJECT
      - DIRECT
      - Geo-HK
      - Geo-TW
      - Geo-SG
      - Geo-JP
      - Geo-US
      - Geo-UK
      - Geo-DE
      - Geo-CN



  - name: DNS-Proxy
    type: select
    use: 
    proxies: 
      - Proxy
      - Auto
      - Geo-HK
      - Geo-TW
      - Geo-SG
      - Geo-JP
      - Geo-US
      - Geo-UK
      - Geo-DE
      - Geo-CN
      - DIRECT
      - Block

  - name: Netflix
    type: select
    proxies: 
      - Proxy

  - name: Apple
    type: select
    proxies: 
      - Proxy

  - name: iCloud
    type: select
    proxies: 
      - Proxy

  - name: MicrosoftCN
    type: select
    proxies: 
      - Proxy

  - name: PayPal
    type: select
    proxies: 
      - Proxy

  - name: Steam
    type: select
    proxies: 
      - Proxy

  - name: Game
    type: select
    proxies: 
      - Proxy

  - name: Facebook
    type: select
    proxies: 
      - Proxy

  - name: Twitter
    type: select
    proxies: 
      - Proxy

  - name: Telegram
    type: select
    proxies: 
      - Proxy

  - name: GlobalTV
    type: select
    proxies: 
      - Proxy

  - name: YouTube
    type: select
    proxies: 
      - Proxy

  - name: Spotify
    type: select
    proxies: 
      - Proxy

  - name: SpeedTest
    type: select
    proxies: 
      - Proxy

  - name: Download
    type: select
    proxies: 
      - Proxy

  - name: CN
    type: select
    disable-dns: true
    proxies: 
      - Proxy

  - name: Mismatch
    type: select
    proxies: 
      - Proxy

proxy-providers:
  Subscription-1:
    type: http
    url: "https://oss.v2rayse.com/proxies/data/2024-06-17/Z09ooZD.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-1.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
   #   User-Agent:
   #     - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-2:
    type: http
    url: "https://proxypool1999.banyunxiaoxi.icu/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-2.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
  #    User-Agent:
  #      - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-3:
    type: http
    url: "http://brovee.myds.me:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-3.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
   #   User-Agent:
  #      - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-4:
    type: http
    url: "https://raw.githubusercontent.com/WilliamStar007/ClashX-V2Ray-TopFreeProxy/main/combine/clash.config.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-4.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
  #    User-Agent:
 #       - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-5:
    type: http
    url: "http://141.147.161.50:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-5.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
  #    User-Agent:
 #       - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-6:
    type: http
    url: "http://150.230.195.209:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-6.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
  #    User-Agent:
  #      - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-7:
    type: http
    url: "http://beetle.lander.work/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-7.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
   #   User-Agent:
   #     - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-8:
    type: http
    url: "http://66.42.50.118:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-8.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
   #  User-Agent:
    #    - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-9:
    type: http
    url: "http://174.137.58.32:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-9.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-10:
    type: http
    url: "https://raw.githubusercontent.com/nasheep/FreeNode/main/clash/PlayLab" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-10.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
    #  User-Agent:
   #     - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true


  Subscription-12:
    type: http
    url: "https://laxcity.pages.dev/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-12.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
     # User-Agent:
     #   - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-13:
    type: http
    url: "https://proxy.fldhhhhhh.top/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-13.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
   #   User-Agent:
    #    - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-14:
    type: http
    url: "https://timell.pages.dev/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-14.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
   #   User-Agent:
   #     - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-15:
    type: http
    url: "http://155.248.172.106:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-15.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
      User-Agent:
        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

#  Subscription-16:
#    type: http
#    url: "http://175.178.182.178:12580/clash/proxies" # replace this URL with your provider's subscription link
#    path: ./providers/Subscription-16.yaml
#    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
#    header:
 #     User-Agent:
 #       - "Clash/v1.11.8"
 #   health-check:
 #     enable: false
#      interval: 0
#      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-17:
    type: http
    url: "https://raw.githubusercontent.com/free18/v2ray/main/Clash.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-17.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
    #  User-Agent:
    #    - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-18:
    type: http
    url: "https://raw.githubusercontent.com/abbasdvd3/clash/main/1.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-18.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
 #    User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true


  Subscription-20:
    type: http
    url: "https://raw.githubusercontent.com/lagzian/SS-Collector/main/mix_clash.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-20.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
  #    User-Agent:
  #      - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true


  Subscription-23:
    type: http
    url: "https://raw.githubusercontent.com/Alvin9999/pac2/master/clash/1/config.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-23.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
 #     User-Agent:
 #       - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-24:
    type: http
    url: "http://haohaoxiong.myqnapcloud.com:12580/clash/proxies" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-24.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
  #    User-Agent:
 #       - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-25:
    type: http
    url: "https://raw.githubusercontent.com/ermaozi01/free_clash_vpn/main/subscribe/clash.yml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-25.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 300
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

script:
#  path: ./script.star
  code: |
    blockHosts = ['analytics', 'adservice', 'firebase', 'bugly', 'safebrowsing', 'doubleclick']
    directHosts = ['push.apple.com', 'iosapps.itunes.apple.com', 'jetbrains.com', 'msftconnecttest.com']

    def main(ctx, metadata):
      network = metadata["network"]
      dst_port = int(metadata["dst_port"])
      if network == 'udp' and dst_port == 443:
        return "REJECT"

      if network == "udp" and (dst_port == 123 or (dst_port >= 136 and dst_port <=139)):
        return "DIRECT"

      host = metadata["host"]
      for kw in blockHosts:
        if kw in host:
          return "REJECT"

      if ctx.rule_providers['category-ads-all'].match(metadata):
        return "Block"

      for kw in directHosts:
        if kw in host:
          return "DIRECT"

      if ctx.rule_providers['icloud'].match(metadata):
        return "iCloud"

      if ctx.rule_providers['apple'].match(metadata):
        return "Apple"

      if ctx.rule_providers['microsoft@cn'].match(metadata):
        return "MicrosoftCN"

      if ctx.rule_providers['paypal@cn'].match(metadata):
        return "CN"

      if ctx.rule_providers['paypal'].match(metadata):
        return "PayPal"

      if ctx.rule_providers['twitter'].match(metadata):
        return "Twitter"

      if ctx.rule_providers['facebook'].match(metadata):
        return "Facebook"

      if ctx.rule_providers['youtube'].match(metadata):
        return "YouTube"

      if ctx.rule_providers['geolocation-!cn'].match(metadata):
        return "Proxy"

      if ctx.rule_providers['geolocation-cn'].match(metadata):
        return "CN"

      code = ""
      ip = metadata["dst_ip"]
      if ip != "":
        code = ctx.geoip(ip)
        if code == "PRIVATE" or code == "LAN":
          return "DIRECT"
        if code == "TELEGRAM":
          return "Telegram"
      else:
        ip = ctx.resolve_ip(host)

      if ip == "":
        return "Mismatch"

      code = ctx.geoip(ip) if code == "" else code
      if code == "CN":
        return "CN"

      return "Mismatch" # default policy for requests which are not matched by any other script

  engine: expr # or starlark (10x to 20x slower)
  shortcuts:
    QUIC: |
      network == "udp" and dst_port == 443
    Privacy: |
      any(["analytics", "adservice", "firebase", "safebrowsing", "doubleclick", "bugly", "bugsnag"], host contains #)
    BilibiliUdp: |
      network == "udp" and match_provider("bilibili")
    DirectUdp: |
      network == "udp" and (dst_port == 123 or (dst_port >= 136 and dst_port <=139))

rules:
  - GEOIP,private,DIRECT,no-resolve
  - GEOIP,telegram,Telegram,no-resolve
#  - GEOIP,paypal@cn,CN
#  - GEOIP,paypal,PayPal
  - GEOIP,twitter,Twitter
  - GEOIP,facebook,Facebook
  - GEOIP,youtube,YouTube
  - SCRIPT,QUIC,REJECT # Disable QUIC
  - SCRIPT,Privacy,REJECT
  - SCRIPT,BilibiliUdp,REJECT
  - SCRIPT,DirectUdp,DIRECT
  - DOMAIN-SUFFIX,push.apple.com,DIRECT
  - DOMAIN-SUFFIX,jetbrains.com,DIRECT
  - DOMAIN-SUFFIX,msftconnecttest.com,DIRECT
  - DOMAIN,iosapps.itunes.apple.com,DIRECT
  - GEOIP,cn,CN
  - GEOIP,ir,CN
  - MATCH,Mismatch
