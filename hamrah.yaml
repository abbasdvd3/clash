

port: 7890
socks-port: 7891
mixed-port: 7892
redir-port: 9797
tproxy-port: 9898
external-controller: 127.0.0.1:9090 
external-ui: /clash/dashboard
geox-url:
  geoip: "https://raw.githubusercontent.com/Chocolate4U/Iran-v2ray-rules/release/geoip.dat"
  geosite: "https://raw.githubusercontent.com/Chocolate4U/Iran-v2ray-rules/release/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/geoip.metadb"
  asn: "https://raw.githubusercontent.com/Chocolate4U/Iran-v2ray-rules/geolite2/GeoLite2-ASN.mmdb"
ipv6: false
allow-lan: true
tcp-concurrent: true
unified-delay: false
geodata-mode: true
geo-auto-update: false 
geo-update-interval: 24 
keep-alive-interval: 1800  
# mode: rule  
log-level: debug
global-client-fingerprint: random # 
geodata-loader: standard 
find-process-mode: strict
bind-address: '*'
# host
      
hosts:
  time.facebook.com: 17.253.84.125
  time.android.com: 17.253.84.125
  '*.mihomo.dev': 127.0.0.1
  '.dev': 127.0.0.1
  'alpha.mihomo.dev': '::1'
  test.com: [1.1.1.1, 2.2.2.2]


# tls:
  # certificate: string # 
  # private-key: string # 

dns:   
  cache-algorithm: arc
  enable: true
  listen: 0.0.0.0:1053
  use-hosts: true
  ipv6: true
  ipv6-timeout: 300  
  prefer-h3: true  
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*'
    - '+.lan'
  nameserver:    
    - tls://223.5.5.5
    - tls://dot.pub
    - tls://[2001:4860:4860::8844]#FINAL
    - tls://[2606:4700:4700::1001]#FINAL
  default-nameserver: 
    - 223.5.5.5
#    - tls://dot.pub
  nameserver-policy:
    "geosite:ir,private":
      - tls://223.5.5.5
      - tls://dot.pub
    "rule-set:ir,private,nsfw1":
      - tls://223.5.5.5
      - tls://dot.pub         
  proxy-server-nameserver:
    - tls://223.5.5.5
    - tls://dot.pub     
  fallback:
    - quic://a.passcloud.xyz:784#FINAL
    - tls://8.8.4.4:853#PROXY
  fallback-filter:    
    geoip: true
    geoip-code: ir
    geosite:      
      - ir
    ipcidr:
      - 240.0.0.0/4
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'
      - '+.googleapis.+'     
      
tun:    
  enable: true
  device: utun # gvisor/mixed
  mtu: 9000 
  stack: system 
  dns-hijack:
    - any:53  
    - tcp://any:53
    - 114.114.114.114
    - 180.76.76.76
    - 119.29.29.29
    - 223.5.5.5
    - 8.8.8.8
    - 8.8.4.4
    - 1.1.1.1
    - 1.0.0.1
  auto-route: true 
  auto-detect-interface: true  
  inet4-route-address: 
    - 0.0.0.0/1
    - 128.0.0.0/1
  inet6-route-address: 
    - "::/1"
    - "8000::/1"
  strict-route: true 
  include_android_user:
    - 0
    

sniffer:                
  enable: false                
  force-dns-mapping: false
  parse-pure-ip: false          
  override-destination: false      
  sniff:   
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [ 443 ]
    HTTP: 
      ports: [80, 8080-8880]
      override-destination: true 
  force-domain:
    - google.com
    - +.v2ex.com
  skip-domain:
    - Mijia Cloud
    - +.apple.com
  sniffing:
    - tls
    - http
  port-whitelist:
    - "80"
    - "443"
  
profile:
  store-selected: true
  store-fake-ip: true
proxies:
proxy-groups:
  - name: proxy
    type: select
 #   exclude-filter: Traffic|Expire
    url: http://cp.cloudflare.com/generate_204
  #  include-all-proxies: true
    include-all-providers: true
    icon: https://fastly.jsdelivr.net/gh/dongchengjie/metaST@main/metaST/Resources/icons/adjust.svg
    proxies: [url-test, fallback, America]
    
  - name: url-test
    type: url-test
 #   exclude-filter: Traffic|Expire
    url: http://cp.cloudflare.com/generate_204
 #   interval: '300'
#    tolerance: '50'
    icon: https://fastly.jsdelivr.net/gh/dongchengjie/metaST@main/metaST/Resources/icons/speed.svg
    include-all-proxies: true
    include-all-providers: true
    proxies: []

  - name: fallback
    type: fallback
 #   exclude-filter: Traffic|Expire
    url: http://cp.cloudflare.com/generate_204
 #   interval: '180'
    icon: https://fastly.jsdelivr.net/gh/dongchengjie/metaST@main/metaST/Resources/icons/link.svg
    include-all-proxies: true
    include-all-providers: true
    proxies: []

  - name: üéØ
    type: select
    udp: false
    hidden: false
    icon: https://fastly.jsdelivr.net/gh/dongchengjie/metaST@main/metaST/Resources/icons/bug.svg
    proxies: [DIRECT, url-test, fallback]

  - name: FINAL
    type: select
#    exclude-filter: Traffic|Expire
    icon: https://fastly.jsdelivr.net/gh/dongchengjie/metaST@main/metaST/Resources/icons/fish.svg
   # include-all-proxies: true
    include-all-providers: true
    proxies: [proxy, url-test, fallback, America, DIRECT]
    
  - name: America
    type: url-test
#    exclude-filter: Traffic|Expire
    url: http://cp.cloudflare.com/generate_204
#    interval: '300'
 #   tolerance: '50'
    icon: https://raw.githubusercontent.com/abbasdvd3/clash/main/rule_provider/usa.svg
    include-all-proxies: true
    include-all-providers: true
    proxies: []
    filter: "üá∫üá∏|US|America|United.*?States|Áæé|Ê≥¢ÁâπÂÖ∞|ËææÊãâÊñØ|‰øÑÂãíÂÜà|Âá§Âá∞Âüé|Ë¥πÂà©Ëíô|Á°ÖË∞∑|ÊãâÊñØÁª¥Âä†ÊñØ|Ê¥õÊùâÁü∂|Âú£‰ΩïÂ°û|Âú£ÂÖãÊãâÊãâ|Ë•øÈõÖÂõæ|ËäùÂä†Âì•"
proxy-providers:

  i:
    type: http
    url: "https://raw.githubusercontent.com/abbasdvd3/clash/main/vless/i" # https://raw.githubusercontent.com/lagzian/SS-Collector/main/SS/trinity_clash.yaml 
    interval: 600
    path: H/i.yaml
#    exclude-filter: Expire
    health-check:
      enable: true
      interval: 90
      url: http://cp.cloudflare.com/generate_204
 
rule-providers:
  ir:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/ir.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/ir.yaml
    interval: 86400
  ads:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/ads.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/ads.yaml
    interval: 86400
  malware:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/malware.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/malware.yaml
    interval: 86400
  phishing:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/phishing.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/phishing.yaml
    interval: 86400
  cryptominers:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/cryptominers.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/cryptominers.yaml
    interval: 86400
  ircidr:
    type: http
    behavior: classical
    format: yaml
    path: ruleset/ircidr.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/ircidr.yaml
    interval: 86400
  private:
    type: http
    behavior: classical
    format: yaml
    path: ruleset/private.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/private.yaml
    interval: 86400
  irasn:
    type: http
    behavior: classical
    format: yaml
    path: ruleset/irasn.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/irasn.yaml
    interval: 86400
  block:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/block.yaml
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt
    interval: 86400
  AWA:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/AWA.yaml
    url: https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml
    interval: 86400
  BanAD:
    type: http
    behavior: domain
    format: text
    path: ruleset/BanAD.list
    url: https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list
    interval: 3600
  BanProgramAD:
    type: http
    behavior: domain
    format: text
    path: ruleset/BanProgramAD.list
    url: https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanProgramAD.list
    interval: 3600
  BanEasyList:
    type: http
    behavior: domain
    format: text
    path: ruleset/BanEasyList.list
    url: https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyList.list
    interval: 3600
  BanEasyListChina:
    type: http
    behavior: domain
    format: text
    path: ruleset/BanEasyListChina.list
    url: https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyListChina.list
    interval: 3600
  BanEasyPrivacy:
    type: http
    behavior: domain
    format: text
    path: ruleset/BanEasyPrivacy.list
    url: https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyPrivacy.list
    interval: 3600  
  DNS:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/DNS.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/release/rule/Clash/DNS/DNS.yaml
    interval: 3600
  GitHub:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/GitHub.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/release/rule/Clash/GitHub/GitHub.yaml
    interval: 3600
  AdGuardSDNSFilter:
    type: http
    behavior: domain
    format: text
    path: ruleset/AdGuardSDNSFilter.text
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/release/rule/Clash/AdGuardSDNSFilter/AdGuardSDNSFilter_Domain.txt
    interval: 3600
  BlockHttpDNS:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/BlockHttpDNS.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/release/rule/Clash/BlockHttpDNS/BlockHttpDNS.yaml
    interval: 3600
  AdGuardSDNSFilterDirect:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/AdGuardSDNSFilterDirect.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/release/rule/Clash/AdGuardSDNSFilter/Direct/Direct.yaml
    interval: 3600
  ChinaDNS:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/ChinaDNS.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/release/rule/Clash/ChinaDNS/ChinaDNS.yaml
    interval: 3600
  Adblock1:
    type: http
    behavior: domain
    format: text
    path: ruleset/Adblock1.list
    url: https://raw.githubusercontent.com/LM-Firefly/Rules/master/Adblock/Adblock.list
    interval: 3600
  DNS2:
    type: http
    behavior: domain
    format: text
    path: ruleset/DNS2.list
    url: https://raw.githubusercontent.com/LM-Firefly/Rules/master/Special/DNS.list
    interval: 3600
  category-ads-all:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/category-ads-all.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/category-ads-all.yaml
    interval: 86400
  nsfw1:
    type: http
    behavior: domain
    path: ruleset/nsfw1.yaml
    url: https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/nsfw.yaml
    interval: 86400
  LocalAreaNetwork:
    type: http
    behavior: domain
    format: yaml
    path: ruleset/LocalAreaNetwork.yaml
    url: https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list
    interval: 3600 
  geolocation-!cn:
    type: http
    behavior: domain
    format: text
    path: ruleset/geolocation-!cn.list
    url: https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.list
    interval: 3600 
rules :
  - RULE-SET,geolocation-!cn,FINAL
  - DOMAIN-SUFFIX,v2rayse.com,proxy
  - DOMAIN-SUFFIX,cff.pw,proxy
  - DOMAIN-SUFFIX,vpnse.org,proxy
  - DOMAIN-SUFFIX,cfmem.com,proxy
  - DOMAIN-SUFFIX,v2rayse.com,proxy
  - DOMAIN-SUFFIX,cff.pw,proxy
  - DOMAIN-SUFFIX,vpnse.org,proxy
  - DOMAIN-SUFFIX,cfmem.com,proxy
  - DST-PORT,80/8080/443/8443,FINAL
  - IN-TYPE,inner,FINAL
  - DOMAIN,ad.com,REJECT
  - DOMAIN-SUFFIX,google.com,FINAL
  - DOMAIN-KEYWORD,google,FINAL
  - DOMAIN-REGEX,^abc.*com,FINAL
  - GEOSITE,youtube,FINAL
  - RULE-SET,LocalAreaNetwork,DIRECT,no-resolve
  - RULE-SET,ir,DIRECT,no-resolve
  - RULE-SET,ircidr,DIRECT
  - RULE-SET,irasn,DIRECT
  - RULE-SET,private,DIRECT,no-resolve
 # - RULE-SET,ads,REJECT
#  - RULE-SET,malware,REJECT
  - RULE-SET,phishing,REJECT
  - RULE-SET,cryptominers,REJECT
  
  - RULE-SET,nsfw1,FINAL
  
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,ip6-localhost,DIRECT
  - DOMAIN-SUFFIX,ip6-loopback,DIRECT
 
  - DOMAIN-SUFFIX,localhost,DIRECT
  - DOMAIN-SUFFIX,.ir,DIRECT
  - DOMAIN-SUFFIX,ir,DIRECT
  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yacd.haishan.me,DIRECT
  - DOMAIN,yacd.metacubex.one,DIRECT
  - DOMAIN,clash.metacubex.one,DIRECT
  - GEOSITE,category-ir,DIRECT
  - GEOSITE,category-ads-all,REJECT
  - GEOIP,private,DIRECT,no-resolve 
  - GEOIP,IR,DIRECT
#  - RULE-SET,BanAD,REJECT
#  - RULE-SET,BanProgramAD,REJECT
 # - RULE-SET,category-ads-all,REJECT
#  - RULE-SET,ChinaDNS,REJECT
#  - RULE-SET,DNS,REJECT
  - RULE-SET,AWA,REJECT
#  - RULE-SET,block,REJECT
#  - RULE-SET,Adblock1,REJECT
#  - RULE-SET,DNS2,REJECT
#  - RULE-SET,AdGuardSDNSFilterDirect,REJECT
#  - RULE-SET,BlockHttpDNS,REJECT
 # - RULE-SET,AdGuardSDNSFilter,REJECT
  
  - GEOSITE,category-ads-all,REJECT
  #- GEOIP,CN,DIRECT,no-resolve
  - GEOIP,ir,DIRECT,no-resolve
  - GEOIP,facebook,FINAL,no-resolve
  - GEOIP,google,FINAL
  - GEOIP,twitter,FINAL,no-resolve
  - GEOIP,telegram,FINAL,no-resolve
  - DOMAIN-SUFFIX,googlesyndication.com,FINAL
  - SRC-IP-CIDR,192.168.1.201/32,DIRECT
  - SRC-IP-SUFFIX,192.168.1.201/8,DIRECT
  - AND,((DOMAIN,baidu.com),(NETWORK,UDP)),DIRECT
  - OR,((NETWORK,UDP),(DOMAIN,baidu.com)),REJECT
  - AND,((PROCESS-NAME,clash),(NOT,((IN-TYPE,inner)))),REJECT
  - AND,((GEOSITE,category-ads-all),(NOT,((DOMAIN-SUFFIX,googlesyndication.com)))),REJECT
  - AND,((NETWORK,udp),(OR,((DST-PORT,443/80),(GEOSITE,youtube)))),REJECT
  - AND,((NETWORK,udp),(GEOSITE,youtube)),REJECT
  - IP-CIDR,127.0.0.1/32,REJECT,no-resolve
  - IP-CIDR,198.18.0.1/16,REJECT,no-resolve
  - IP-CIDR,28.0.0.1/8,REJECT,no-resolve
  - IP-CIDR6,::1/128,REJECT,no-resolve
  - IP-CIDR,10.10.0.0/32,FINAL
  - IP-CIDR,10.20.0.0/32,FINAL
  - IP-CIDR,10.10.34.35/32,FINAL
  - PROCESS-NAME,com.sec.location.nsflp2,REJECT
  - PROCESS-NAME,com.samsung.android.location,REJECT
  - PROCESS-NAME,com.android.localtransport,REJECT
  - PROCESS-NAME,com.google.android.gms.location.history,REJECT
  - PROCESS-NAME,com.sec.location.nsflp2,REJECT
  - PROCESS-NAME,com.android.location.fused,REJECT
  - PROCESS-NAME,com.samsung.android.messaging,REJECT
  - PROCESS-NAME,com.samsung.android.app.telephonyui,REJECT
  - PROCESS-NAME,com.samsung.android.smartcallprovider,REJECT
  - PROCESS-NAME,com.samsung.android.intellivoiceservice,REJECT
#  - PROCESS-NAME,com.android.settings,REJECT
  - PROCESS-NAME,com.sec.imsservice,REJECT
  - PROCESS-NAME,com.samsung.android.messaging,REJECT
  - PROCESS-NAME,com.samsung.android.app.telephonyui,REJECT
  - PROCESS-NAME,com.samsung.android.smartcallprovider,REJECT
  - PROCESS-NAME,com.samsung.android.intellivoiceservice,REJECT
  - MATCH,FINAL
