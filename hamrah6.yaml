# port: 7890
# socks-port: 7891
allow-lan: true
mode: Rule
bind-address: "*"
ipv6: false
log-level: info
find-process-mode: always
enable-process: true
unified-delay: false
keep-alive-interval: 15
tcp-concurrent: true
geodata-mode: false

external-controller: 0.0.0.0:9090
external-ui: ui
external-ui-url: "https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip"
global-client-fingerprint: chrome
geox-url:
  geoip: "https://raw.githubusercontent.com/Chocolate4U/Iran-v2ray-rules/release/geoip.dat"
  geosite: "https://raw.githubusercontent.com/Chocolate4U/Iran-v2ray-rules/release/geosite.dat"
  mmdb: "https://raw.githubusercontent.com/Chocolate4U/Iran-clash-rules/release/geoip.metadb"
  asn: "https://raw.githubusercontent.com/Chocolate4U/Iran-v2ray-rules/geolite2/GeoLite2-ASN.mmdb"
geo-auto-update: true
geo-update-interval: 24
global-ua: clash.meta
profile:
  store-selected: true
  store-fake-ip: true
experimental:
  quic-go-disable-gso: false
  quic-go-disable-ecn: false
sniffer:
  enable: false
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
tun:
  enable: true
  stack: mixed
  dns-hijack:
    - 'any:53'
  auto-route: true
  auto-detect-interface: true
dns:
  enable: true
  use-hosts: true
  ipv6: false
  remote-dns-resolve: false# default value is true
  enhanced-mode: fake-ip # redir-host # fake-ip
  fake-ip-range: 28.0.0.0/16
  listen: 0.0.0.0:1053
  default-nameserver:
#    - 114.114.114.114
  #  - 119.29.29.29
 #   - 119.28.28.28
    - 8.8.8.8
    - 1.1.1.1
#    - tls://1.12.12.12:853
#    - tls://223.5.5.5:853
 # proxy-server-nameserver:
#    - https://1.12.12.12/dns-query
#    - https://223.5.5.5/dns-query
  nameserver:
    - 1.1.1.1
#    - https://120.53.53.53/dns-query
#    - tls://223.6.6.6:853
    - 8.8.8.8
 #   - tls://223.5.5.5:853
#    - tls://223.6.6.6:853
#    - tls://120.53.53.53
 #   - tls://1.12.12.12
#    - 114.114.114.114#PROXY 
 #   - tls://223.5.5.5:853
 #   - dhcp://en0
#    - quic://dns.adguard.com:784#PROXY
 #   - tls://dot.pub:853
  remote-nameserver:
    - https://8.8.8.8/dns-query
#    - tls://8.8.8.8:853
#  fallback:
 #   - tcp://8.8.8.8:53#DNS-Proxy # if set `remote-dns-resolve` to false, then enable it.
  fake-ip-filter:
    - '*.lan'
    - '+.example.com'
#  nameserver-policy:
#    '+.example.com': 192.168.1.254  
#    "geosite:.ir,private": 
#      - https://223.5.5.5/dns-query
#      - https://120.53.53.53/dns-query
#    "geosite:ir":
#      - https://8.8.4.4/dns-query#机场
#      - https://1.0.0.1/dns-query#机场
 # proxy-server-nameserver:
#    - https://223.5.5.5/dns-query
 #   - https://120.53.53.53/dns-query
proxies:
  - name: dns-out
    type: dns
proxy-groups:
  - name: Proxy
    type: select
    use: *Use
    proxies:
      - Auto
      - dns-out
      - Geo-HK
      - Geo-TW
      - Geo-SG
      - Geo-JP
      - Geo-US
      - Geo-UK
      - Geo-DE
      - Geo-CN
      - DIRECT
      - Block
  - name: Auto
    type: url-test
    interval: 900
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    use: &Use
      - Subscription-1
      - Subscription-2
      - Subscription-3
      - Subscription-4
      - Subscription-5
      - Subscription-6
      - Subscription-7

  - name: Geo-HK
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "HongKong|HK|香港"
    use: *Use

  - name: Geo-TW
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "Taiwan|TW|台湾"
    use: *Use

  - name: Geo-SG
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "Singapore|SG|新加坡"
    use: *Use

  - name: Geo-JP
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "Japan|JP|日本"
    use: *Use

  - name: Geo-US
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "America|United States|US|美国"
    use: *Use

  - name: Geo-UK
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "Britain|England|UK|英国"
    use: *Use

  - name: Geo-DE
    type: url-test
    interval: 600
    tolerance: 100
    url: http://www.gstatic.com/generate_204
    filter: "Germany|Deutsch|DE|德国"
    use: *Use

  - name: Geo-CN
    type: select
 #   disable-dns: true
    filter: "China|CN|中国"
    use: *Use
    proxies:
    #  - DIRECT

  - name: Block
    type: select
    use: *Use
    proxies:
      - REJECT
      - DIRECT
      - dns-out
      - Geo-HK
      - Geo-TW
      - Geo-SG
      - Geo-JP
      - Geo-US
      - Geo-UK
      - Geo-DE
      - Geo-CN

  - name: DNS-Proxy
    type: select
    use: *Use
    proxies: &Proxy
      - Proxy
      - Auto
      - dns-out
      - Geo-HK
      - Geo-TW
      - Geo-SG
      - Geo-JP
      - Geo-US
      - Geo-UK
      - Geo-DE
      - Geo-CN
      - DIRECT
      - Block

  - name: Netflix
    type: select
    use: *Use
    proxies: *Proxy

  - name: Apple
    type: select
    use: *Use
    proxies: *Proxy

  - name: iCloud
    type: select
    use: *Use
    proxies: *Proxy

  - name: MicrosoftCN
    type: select
    use: *Use
    proxies: *Proxy

  - name: PayPal
    type: select
    use: *Use
    proxies: *Proxy

  - name: Steam
    type: select
    use: *Use
    proxies: *Proxy

  - name: Game
    type: select
    use: *Use
    proxies: *Proxy

  - name: Facebook
    type: select
    use: *Use
    proxies: *Proxy

  - name: Twitter
    type: select
    use: *Use
    proxies: *Proxy

  - name: Telegram
    type: select
    use: *Use
    proxies: *Proxy

  - name: GlobalTV
    type: select
    use: *Use
    proxies: *Proxy

  - name: YouTube
    type: select
    use: *Use
    proxies: *Proxy

  - name: Spotify
    type: select
    use: *Use
    proxies: *Proxy

  - name: SpeedTest
    type: select
    use: *Use
    proxies: *Proxy

  - name: Download
    type: select
    use: *Use
    proxies: *Proxy

  - name: CN
    type: select
 #   disable-dns: true
    use: *Use
    proxies: *Proxy

  - name: Mismatch
    type: select
    use: *Use
    proxies: *Proxy

proxy-providers:
  Subscription-1:
    type: http
    url: "https://chromego-sub.netlify.app/sub/merged_proxies_new.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-1.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-2:
    type: http
    url: "https://raw.githubusercontent.com/aiboboxx/clashfree/main/clash.yml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-2.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
     header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-3:
    type: http
    url: "https://raw.githubusercontent.com/anaer/Sub/main/clash.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-3.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-4:
    type: http
    url: "https://raw.githubusercontent.com/mahdibland/V2RayAggregator/master/sub/sub_merge_yaml.yml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-4.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-5:
    type: http
    url: "https://raw.githubusercontent.com/ronghuaxueleng/get_v2/main/pub/combine.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-5.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-6:
    type: http
    url: "https://raw.githubusercontent.com/chengaopan/AutoMergePublicNodes/master/list.yml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-6.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true

  Subscription-7:
    type: http
    url: "https://raw.githubusercontent.com/dongchengjie/airport/main/subs/merged/tested_within.yaml" # replace this URL with your provider's subscription link
    path: ./providers/Subscription-7.yaml
    interval: 6
#    prefix-name: "S-"
#    url-proxy: true
#    udp: true
    header:
#      User-Agent:
#        - "Clash/v1.11.8"
    health-check:
      enable: true
      interval: 0
      url: http://www.gstatic.com/generate_204
#      lazy: false # default value is true


rules:
  - GEOIP,private,DIRECT,no-resolve
  - GEOIP,telegram,Telegram,no-resolve

  - DOMAIN-SUFFIX,push.apple.com,DIRECT

  - GEOSITE,category-ads-all,Block

  - DOMAIN-SUFFIX,jetbrains.com,DIRECT
  - DOMAIN-SUFFIX,msftconnecttest.com,DIRECT
  - DOMAIN,iosapps.itunes.apple.com,DIRECT

  - GEOSITE,openai,iCloud
  - GEOIP,openai,Apple
  - GEOSITE,microsoft,MicrosoftCN
  - GEOSITE,nsfw,PayPal
  - GEOIP,nsfw,Twitter
  - GEOSITE,social,Facebook
  - GEOIP,social,YouTube
  - GEOSITE,google,YouTube
  - GEOIP,google,YouTube
  - GEOIP,private,DIRECT,no-resolve
  - GEOIP,github,DIRECT,no-resolve
  - GEOSITE,github,DIRECT,no-resolve
  - GEOSITE,category-ads-all,REJECT
  - GEOSITE,malware,REJECT
  - GEOSITE,phishing,REJECT
  - GEOSITE,cryptominers,REJECT
  - GEOIP,malware,REJECT
  - GEOIP,phishing,REJECT
  - GEOSITE,ir,DIRECT
  - GEOIP,ir,DIRECT

  - MATCH,Mismatch
